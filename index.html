<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ü–ª—é–π-–ö–∞–º–Ω–∏</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet" />

  <style>
    body {
      background-image: url('https://radika1.link/2025/08/01/ra_forum_background_img_08c2550a6ef5a7985.jpg');
      background-size: auto;
      background-position: center;
      background-repeat: repeat;
      font-family: 'Georgia', serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #B0B3B9;
    }

    .header-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 10px;
      width: 100%;
    }

    .ravenclaw-title {
      font-family: 'Permanent Marker', cursive;
      font-weight: 400;
      font-size: 100px;
      margin: 0;
      padding: 0 20px;
      max-width: 100%;
      text-align: center;
      word-break: break-word;
      overflow-wrap: anywhere;
      background: linear-gradient(90deg, #BA9868, #FFD580);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }

    h1 {
      color: #C0B29D;
      margin: 5px 0 10px 20px;
    }

    .main-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      width: 100%;
      max-width: 1300px;
      margin-bottom: 30px;
      padding: 0 20px;
      box-sizing: border-box;
    }

    .game-wrapper {
      background-color: #15273F;
      width: 640px;
      padding: 20px 20px 30px 20px;
      border-radius: 12px;
      border: 3px double #8A6A3E;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .field-container {
      position: relative;
      width: 600px;
      height: 600px;
      background-image: url('https://radika1.link/2025/08/01/AddText_08-01-03.22.225b4a3aad5ea2563e.png');
      background-size: cover;
      margin-bottom: 20px;
    }

    .stone {
      position: absolute;
      width: 70px;
      transition: all 0.3s ease;
      user-select: none;
      transform-origin: center;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }

    .buttons {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    button {
      background-color: #23385A;
      color: #BA9868;
      border: 2px double #BA9868;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background-color: #1f2a4c;
    }

    button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .selectors {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
      width: 100%;
    }

    .selectors div {
      display: flex;
      flex-direction: column;
      font-size: 14px;
    }

    select {
      background-color: #23385A;
      color: #BA9868;
      border: 1px solid #8A6A3E;
      border-radius: 6px;
      padding: 6px;
      font-size: 14px;
      max-width: 100%;
    }

    label {
      margin-bottom: 4px;
    }

    .tasks-wrapper {
      background-color: #15273F;
      width: 500px;
      padding: 20px;
      border-radius: 12px;
      border: 3px double #8A6A3E;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      height: fit-content;
    }

    .tasks {
      width: 100%;
      height: 260px;
      background: #23385A;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      font-size: 14px;
      border: 1px solid #8A6A3E;
      overflow-y: auto;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    .tasks ul {
      padding-left: 20px;
      margin: 0;
      list-style-type: none;
    }

    .tasks li {
      margin-bottom: 8px;
      word-break: break-word;
      display: flex;
      align-items: flex-start;
    }

    .task-broken {
      text-decoration: line-through;
      color: #88693D;
    }

    .tasks input[type="checkbox"] {
      margin-right: 10px;
      margin-top: 3px;
      cursor: pointer;
    }

    .output-container {
      width: 100%;
      margin-top: 15px;
    }

    .output {
      width: 100%;
      height: 260px;
      background: #23385A;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      font-size: 14px;
      box-sizing: border-box;
      white-space: pre-wrap;
      font-family: monospace;
      border: 1px solid #8A6A3E;
      overflow-wrap: break-word;
      word-wrap: break-word;
      overflow-y: auto;
    }

    .copy-btn {
      background-color: #23385A;
      color: #BA9868;
      border: 2px double #BA9868;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
      transition: all 0.3s ease;
    }

    .copy-btn:hover {
      background-color: #1f2a4c;
    }

    .hidden {
      display: none;
    }

    #savedBoardsMenu {
      position: fixed;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: #15273F;
      padding: 15px;
      border-radius: 12px;
      border: 3px double #8A6A3E;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 1000;
      width: 200px;
    }

    #savedBoardsMenu h3 {
      margin-top: 0;
      color: #BA9868;
      text-align: center;
    }

    #boardsList {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    #boardsList button {
      position: relative;
      padding-right: 25px;
      text-align: left;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    #boardsList button.active {
      background-color: #3a4d6e;
      box-shadow: 0 0 5px #BA9868;
    }

    #boardsList button span {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
    }

    @media (max-width: 1200px) {
      .main-container {
        flex-direction: column;
        align-items: center;
      }
      
      .tasks-wrapper {
        width: 640px;
      }

      #savedBoardsMenu {
        position: static;
        transform: none;
        width: 100%;
        max-height: none;
        margin-bottom: 20px;
        order: -1;
      }
    }

    @media (max-width: 700px) {
      .game-wrapper, .tasks-wrapper {
        width: 95%;
        padding: 15px;
      }
      
      .field-container {
        width: 100%;
        height: auto;
        aspect-ratio: 1/1;
        background-size: contain;
      }
      
      .ravenclaw-title {
        font-size: 60px;
      }
      
      .buttons {
        flex-direction: column;
        gap: 10px;
        width: 100%;
      }
      
      button {
        width: 100%;
        box-sizing: border-box;
      }
      
      .selectors {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .selectors div {
        width: 100%;
      }
      
      select {
        width: 100%;
        font-size: 12px;
      }
      
      .stone {
        width: 15vw;
        max-width: 60px;
      }
      
      .tasks, .output {
        height: 200px;
        font-size: 12px;
      }
    }

    @media (max-width: 400px) {
      .ravenclaw-title {
        font-size: 40px;
      }
      
      h1 {
        font-size: 18px;
        margin: 5px 0;
      }
      
      .stone {
        width: 12vw;
      }
    }
  </style>
</head>
<body>

<div class="header-block">
  <h1 class="ravenclaw-title">Ravenclaw</h1>
  <h1>–ü–õ–Æ–ô-–ö–ê–ú–ù–ò</h1>
</div>

<div id="savedBoardsMenu">
  <h3>–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–æ—Å–∫–∏</h3>
  <div id="boardsList"></div>
  <div style="margin-top:15px">
    <button onclick="exportAllBoards()" style="width:100%">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö</button>
    <input type="file" id="importBoardsInput" accept=".json" style="display:none">
    <button onclick="document.getElementById('importBoardsInput').click()" style="width:100%;margin-top:5px">üì• –ò–º–ø–æ—Ä—Ç</button>
  </div>
</div>

<div class="main-container">
  <div class="game-wrapper">
    <div class="field-container" id="field"></div>

    <div class="buttons">
      <button id="generateBtn">–ë–†–û–°–ò–¢–¨ –ö–ê–ú–ù–ò</button>
      <button id="manualBtn">–†–ê–ó–õ–û–ñ–ò–¢–¨ –ö–ê–ú–ù–ò</button>
      <button id="saveBtn">–°–û–•–†–ê–ù–ò–¢–¨</button>
    </div>

    <div class="selectors hidden" id="selectors"></div>
  </div>

  <div class="tasks-wrapper">
    <h2>–ó–∞–¥–∞–Ω–∏—è:</h2>
    <div class="tasks">
      <ul id="taskList"></ul>
    </div>
    
    <h3>–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥:</h3>
    <div class="output-container">
      <div class="output" id="formattedOutput"></div>
      <button class="copy-btn" id="copyBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
  </div>
</div>

<script>
const categories = [  {
    name: '–î–ó',
    stones: [
      "I.4e79a21ed961dce48.png", 
      "I.3af60ee1d4f5de6f4.png",
      "I.5d8b3fb70143d1b16.png",
      "I.8a5d66f6f19285263.png",
      "I.105c62525b0e57461e.png",
      "I.11764eb9aba8803329.png",
      "I.12fb94888146693f6c.png",
      "I.21ce84af1b7c7e7a3.png",
      "I.1178e0a3e1d57998e.png",
      "I.6a026d5dcd6720cf0.png",
      "I.136b59f6becc1bd883.png",
      "I.97dda480e5576415e.png",
      "I.7a8aadcef46bb2bb9.png"
    ],
    broken: "I.broken4c11d1df875b4391.png",
    tasks: [
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ –ª—é–±–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É.",
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ—Ä–∏–∫–µ.",
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è–º.",
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ —Ä—É–Ω–æ–ª–æ–≥–∏–∏.",
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ –∑–µ–ª—å–µ–≤–∞—Ä–µ–Ω–∏—é.",
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ —à–∞–º–∞–Ω–∏–∑–º—É.",
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ –æ–Ω–µ–π—Ä–æ–ª–æ–≥–∏–∏.",
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏—é.",
      "–°–¥–∞—Ç—å –¥–æ–º–∞—à–Ω—é—é —Ä–∞–±–æ—Ç—É(–æ—Å–Ω–æ–≤—É) –ø–æ –º–∏—Ñ–æ–ª–æ–≥–∏–∏ –î—Ä–µ–≤–Ω–µ–π –ì—Ä–µ—Ü–∏–∏.",
      "–°–¥–∞—Ç—å —Å–æ—á–∏–Ω–µ–Ω–∏–µ –ø–æ –ª—é–±–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É.",
      "–°–¥–∞—Ç—å –¥–æ–∫–ª–∞–¥ –ø–æ –ª—é–±–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É.",
      "–°–¥–∞—Ç—å —ç—Å—Å–µ –ø–æ –ª—é–±–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É.",
      "–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—á–∞—Å—Ç–∏–µ –≤ —É—á–µ–±–Ω–æ–π –¥—É—ç–ª–∏ –∏–ª–∏ –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ —á–µ–π-—Ç–æ –≤—ã–∑–æ–≤."
    ]
  },
  {
    name: '–í–ê',
    stones: [
      "II.6c729d75a4272561e.png",
      "II.5e93d7ab7a9241eb8.png",
      "II.34a56c7be3e10482a.png",
      "II.179b17266e6bb4def.png",
      "II.48dd3fde0a613943c.png",
      "II.2a2a47d29f577bdf4.png",
      "II.7171869a493354150.png"
    ],
    broken: "II.brokena2116b930b6eeea4.png",
    tasks: [
      "–ü–æ—Å–µ—Ç–∏—Ç—å —Ä–µ–¥–∞–∫—Ü–∏—é \"–ü–µ—Ä–∞ –†–æ–≤–µ–Ω—ã\" –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç—Ä–∏ —Ç–µ–º—ã –¥–ª—è —Å—Ç–∞—Ç–µ–π.",
      "–ù–∞–ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ç—å—é –≤ \"–ü–µ—Ä–æ –†–æ–≤–µ–Ω—ã\".",
      "–í –ø–æ–∏—Å–∫–∞—Ö –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ñ–∏–ª—å–º–∞ –Ω–∞ –≤–µ—á–µ—Ä: –ø–æ–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –≤ RavenCinema, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∏–¥–µ—é –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–∏–Ω–æ–ø–æ–∫–∞–∑–∞",
      "–í —É—á–µ–±–Ω–æ–º –æ—Ç–¥–µ–ª–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ö–æ–≥—Ç–µ–≤—Ä–∞–Ω–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—á–∞ –∫–Ω–∏–≥. –ü–æ–º–æ–≥–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é, –ø—Ä–∏–Ω–µ—Å—è –∫–Ω–∏–≥—É –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Ç–µ–º–∞—Ç–∏–∫–∏.",
      "–ó–∞–≥–ª—è–Ω–∏—Ç–µ –≤ —Ä–∞–¥–∏–æ—Ä—É–±–∫—É Rven.FM –∏ –æ—Å—Ç–∞–≤—å—Ç–µ —Ç–∞–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–¥–∏–æ—ç—Ñ–∏—Ä–∞.",
      "–ü–æ—É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –ª—é–±–æ–π –æ–±—â–µ—à–∫–æ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.",
      "–ó–∞–≥–ª—è–Ω–∏—Ç–µ –Ω–∞ –ø–æ–¥–º–æ—Å—Ç–∫–∏ \"–¢–µ–∞—Ç—Ä–∞ –†–æ–≤–µ–Ω—ã\" –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∏–¥–µ—é –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Å–ø–µ–∫—Ç–∞–∫–ª—è."
    ]
  },
  {
    name: '–û–ì',
    stones: [
      "III.264c2525a819ac2d4.png",
      "III.3e513c8ee5cd1920b.png",
      "III.19a14beb8bbfbcf37.png"
    ],
    broken: "III.broken67c2a4fc394557de.png",
    tasks: [
      "–ü–æ—Å–µ—Ç–∏—Ç—å –û–±—â—É—é –≥–æ—Å—Ç–∏–Ω—É—é –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–æ–º –∏ —É—Å—Ç—Ä–æ–∏—Ç—å –∂–∞—Ä–∫–æ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫—Ç–æ –∫—Ä—É—á–µ: –∏–≥—Ä–æ–∫–∏ –≤ –¥—Ä–∞–∫–æ–Ω–±–æ–ª–ª –∏–ª–∏ –∫–≤–∏–¥–¥–∏—á?",
      "–£–∑–Ω–∞—Ç—å —É –æ–±–∏—Ç–∞—Ç–µ–ª–µ–π –∑–∞–º–∫–∞, —á—Ç–æ –ª—é–±–∏—Ç —Å—ç—Ä –î–∞–≥–±–µ—Ä—Ç –∏ –∫–æ–≥–¥–∞ —É –Ω–µ–≥–æ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è, –∞ –ø–æ—Ç–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞–Ω –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–π –≤–µ—á–µ—Ä–∏–Ω–∫–∏.",
      "–ö–∞–∫ –Ω–∞—Å—á–µ—Ç —É—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Å–∏–¥–µ–ª–∫–∏ –≤ –æ–±—â–µ–π –≥–æ—Å—Ç–∏–Ω–æ–π –ø–æ–¥ –ø—Ä–∏—è—Ç–Ω—É—é –º—É–∑—ã–∫—É? –ü–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –ø–æ–º–æ–≥–∏—Ç–µ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–µ–π-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–∏—è—Ç–Ω–æ–≥–æ –≤—Ä–µ–º—è–ø—Ä–µ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è."
    ]
  },
  {
    name: '–ë–ö',
    stones: [
      "IV.117d626aa720157f94.png",
      "IV.8dee236358fed8c2d.png",
      "IV.6e2a127beec2056bc.png",
      "IV.5b2a5f43a7bfb928f.png",
      "IV.4b8d88416b12c4c21.png",
      "IV.314925857f4f5fefc.png",
      "IV.106f88537c1e4020b.png",
      "IV.104e59008e193a887f.png",
      "IV.29658e6ee4f1768dc.png",
      "IV.9c53f3f12c207bc05.png",
      "IV.7b891c2f733b6573f.png"
    ],
    broken: "IV.broken9caddce6851f0cea.png",
    tasks: [
      "–ù–∞–≤–µ–¥–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –≤ —Å–≤–æ–µ–π –∫–æ–º–Ω–∞—Ç–µ, –∞ —Ç–æ –ø–æ –Ω–µ–π —Å–ª–æ–≤–Ω–æ –®—É—à –ø—Ä–æ—à–µ–ª.",
      "–ü–æ–∏—Å–∫–∏ –ø—Ä–æ–ø–∞–≤—à–µ–≥–æ –∫–æ—Ç–∞ —Å—Ç–∞—Ä–æ—Å—Ç—ã ‚Äî —Å–ª–µ–¥—ã –≤–µ–¥—É—Ç –∫ –∑–∞–±—Ä–æ—à–µ–Ω–Ω–æ–π –∫–∞–º–æ—Ä–∫–µ.",
      "–ü–æ–º–æ–≥–∏—Ç–µ –¥–æ–º–æ–≤–æ–º—É —ç–ª—å—Ñ—É –¢–µ–¥–¥–∏ –Ω–∞ –∫—Ä—ã—à–µ —Ñ—Ä—É–∫—Ç–æ–≤–æ–≥–æ —Å–∞–¥–∞, –∫–∞–∂–µ—Ç—Å—è –ø–æ—Å–∞–¥–∫—É —á–µ—Ä–Ω–∏–∫–∏ –∞—Ç–∞–∫–æ–≤–∞–ª–∞ —Å—Ç–∞—è –Ω—é—Ö–ª–µ—Ä–æ–≤.",
      "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –≥–æ—Å—Ç–µ–π –∏ —É—Å—Ç—Ä–æ–π—Ç–µ —á–∞–µ–ø–∏—Ç–∏–µ –≤ –≥–æ—Å—Ç–∏–Ω–æ–π –ö–æ–≥—Ç–µ–≤—Ä–∞–Ω–∞.",
      "–ü—Ä–∏–¥—É–º–∞—Ç—å –∏ –æ–ø–∏—Å–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç –∫–æ–≥—Ç–µ–≤—Ä–∞–Ω—Å–∫–æ–≥–æ –ª–µ–¥–µ–Ω—Ü–∞ —Å —Ñ—Ä—É–∫—Ç–æ–º –∏–ª–∏ —Ü–≤–µ—Ç–∫–æ–º ‚Äî –≤–∫—É—Å, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ñ–æ—Ä–º–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.",
      "–í —á–∏—Ç–∞–ª—å–Ω–æ–º –∑–∞–ª–µ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ –∫–ª—É–±–∞ –≤—Å–µ –ø–æ–∫—Ä—ã–ª–æ—Å—å –ø—ã–ª—å—é, –ø–æ—Ä–∞ –æ–∂–∏–≤–∏—Ç—å —ç—Ç–æ –º–µ—Å—Ç–æ.",
      "–ó–∞–≥–ª—è–Ω—É—Ç—å –≤ –æ—Ä–ª—è—Ç–Ω—é –∏ –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Å–≤–æ–µ–º –ø—Ç–µ–Ω—Ü–µ.",
      "–°–±–æ—Ä–Ω—É—é —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ –ø–æ –∫–≤–∏–¥–¥–∏—á—É —É–∂–µ –¥–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–µ–ª–∏ –≤ –≤–æ–∑–¥—É—Ö–µ. –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É —Ç–µ–ø–ª—ã–º —Å–ª–æ–≤–æ–º –∏–ª–∏ –ø–ª–∞–∫–∞—Ç–æ–º.",
      "–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤ –Ω–∞ –ª—é–±—É—é –∫–Ω–∏–≥—É –≤ –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–º –∫–ª—É–±–µ –±–∞—à–Ω–∏ –ö–æ–≥—Ç–µ–≤—Ä–∞–Ω–∞.",
      "–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤ –Ω–∞ –ª—é–±–æ–π —Å–ø–µ–∫—Ç–∞–∫–ª—å, –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –≤ –±–∞—à–Ω–µ –ö–æ–≥—Ç–µ–≤—Ä–∞–Ω–∞.",
      "–û—Å—Ç–∞–≤—å—Ç–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ ¬´–†–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–π¬ª –±–∞—à–Ω–∏ –ö–æ–≥—Ç–µ–≤—Ä–∞–Ω–∞."
    ]
  },
  {
    name: '–ì–§',
    stones: [
      "V.54fcf7c8b98d02339.png",
      "V.44c075933326fb8f5.png",
      "V.3ef9344f45190e48a.png",
      "V.2e60bc1a7f371d7d4.png",
      "V.1934f694030984945.png",
      "V.6.f37f104c511b2d19.png"
    ],
    broken: "V.broken16efab67b0530f1b.png",
    tasks: [
      "–ù–∞–ø–∏—Å–∞—Ç—å 5 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ ¬´–ë–æ–ª—Ç–∞–ª–∫–µ, —Ñ–ª—É–¥–∏–ª–∫–µ¬ª –Ω–∞ –ì–ª–∞–≤–Ω–æ–º –§–æ—Ä—É–º–µ.",
      "–ó–∞–π—Ç–∏ –≤ –±–∞—à–Ω—é –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –∏ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–æ–≤–∏—á–∫–∞–º–∏.",
      "–ù–∞–ø–∏—Å–∞—Ç—å –¥–∏—Ñ–∏—Ä–∞–º–±—ã —Ç—Ä—ë–º –∑–Ω–∞–∫–æ–º—ã–º.",
      "–°–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ç–µ–º—É –≤ –¢–≤–æ—Ä—á–µ—Å–∫–æ–º —É–≥–æ–ª–∫–µ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç –≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é.",
      "–ü—Ä–æ–≥—É–ª—è–π—Ç–µ—Å—å –ø–æ –û–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç—è–º –•–æ–≥–≤–∞—Ä—Ç—Å–∞ –Ω–∞ –ì–ª–∞–≤–Ω–æ–º –§–æ—Ä—É–º–µ.",
      "–ü–æ—Å–µ—Ç–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç –ª—é–±–æ–≥–æ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞ –∏–ª–∏ —Å—Ç–∞–∂—ë—Ä–∞ –Ω–∞ –ì–ª–∞–≤–Ω–æ–º –§–æ—Ä—É–º–µ."
    ]
  }
];

const coords = {
  'A1': [190.2, 247.6], 'B1': [281.2, 247.6], 'C1': [372.2, 247.6],
  'A2': [190.2, 338.6], 'B2': [281.2, 338.6], 'C2': [372.2, 338.6],
  'A3': [190.2, 429.6], 'B3': [281.2, 429.6], 'C3': [372.2, 429.6]
};

const cellLabels = Object.keys(coords);
const field = document.getElementById('field');
const taskList = document.getElementById('taskList');
const selectorsDiv = document.getElementById('selectors');
const generateBtn = document.getElementById('generateBtn');
const manualBtn = document.getElementById('manualBtn');
const saveBtn = document.getElementById('saveBtn');
const formattedOutput = document.getElementById('formattedOutput');
const copyBtn = document.getElementById('copyBtn');

let selectedStones = {};
let brokenStones = new Set();
let currentBoardName = null;

// ===== –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ—Å–æ–∫ =====
let savedBoards = JSON.parse(localStorage.getItem('savedBoards') || '{}');

function saveCurrentBoard() {
  const name = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ—Å–∫–∏:', currentBoardName || '');
  if (!name) return;
  
  const boardData = {
    stones: selectedStones,
    broken: Array.from(brokenStones),
    timestamp: Date.now()
  };
  
  savedBoards[name] = boardData;
  localStorage.setItem('savedBoards', JSON.stringify(savedBoards));
  currentBoardName = name;
  updateBoardsMenu();
  alert(`–î–æ—Å–∫–∞ "${name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!`);
}

function loadBoard(name) {
  const boardData = savedBoards[name];
  if (!boardData) return;
  
  currentBoardName = name;
  
  // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  field.innerHTML = '';
  taskList.innerHTML = '';
  selectedStones = {};
  brokenStones = new Set(boardData.broken);
  
  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–Ω–∏
  for (const [cellId, stoneData] of Object.entries(boardData.stones)) {
    if (stoneData) {
      selectedStones[cellId] = stoneData;
      placeStone(
        cellId, 
        stoneData.broken ? `https://radika1.link/2025/08/02/${
          categories.find(c => c.name === stoneData.category)?.broken
        }` : stoneData.image
      );
    }
  }
  
  updateTaskList();
  updateBoardsMenu();
}

function updateBoardsMenu() {
  const list = document.getElementById('boardsList');
  list.innerHTML = '';
  
  Object.entries(savedBoards).sort((a,b) => b[1].timestamp - a[1].timestamp)
    .forEach(([name, data]) => {
      const btn = document.createElement('button');
      btn.textContent = name;
      btn.style.width = '100%';
      btn.style.marginBottom = '5px';
      btn.style.textAlign = 'left';
      btn.style.overflow = 'hidden';
      btn.style.textOverflow = 'ellipsis';
      btn.style.whiteSpace = 'nowrap';
      
      if (name === currentBoardName) {
        btn.classList.add('active');
      }
      
      btn.onclick = () => loadBoard(name);
      
      const delBtn = document.createElement('span');
      delBtn.textContent = '√ó';
      delBtn.style.float = 'right';
      delBtn.style.cursor = 'pointer';
      delBtn.onclick = (e) => {
        e.stopPropagation();
        if (confirm(`–£–¥–∞–ª–∏—Ç—å –¥–æ—Å–∫—É "${name}"?`)) {
          delete savedBoards[name];
          localStorage.setItem('savedBoards', JSON.stringify(savedBoards));
          if (name === currentBoardName) {
            currentBoardName = null;
          }
          updateBoardsMenu();
        }
      };
      
      btn.appendChild(delBtn);
      list.appendChild(btn);
    });
}

function exportAllBoards() {
  const data = JSON.stringify(savedBoards, null, 2);
  const blob = new Blob([data], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `plui-kamni-backup-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
}

function importBoards(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = JSON.parse(e.target.result);
      savedBoards = data;
      localStorage.setItem('savedBoards', JSON.stringify(savedBoards));
      currentBoardName = null;
      updateBoardsMenu();
      alert(`–£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${Object.keys(data).length} –¥–æ—Å–æ–∫!`);
    } catch (err) {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞: ' + err.message);
    }
  };
  reader.readAsText(file);
}

function getShortStoneName(fullName) {
  const parts = fullName.split('.');
  return `${parts[0]}.${parts[1].substring(0, 1)}`;
}

function shuffleArray(array) {
  const result = [...array];
  for (let i = result.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [result[i], result[j]] = [result[j], result[i]];
  }
  return result;
}

function applyBrokenEffects(img) {
  const randomRotation = Math.floor(Math.random() * 60) - 30;
  const randomScale = 0.8 + Math.random() * 0.4;
  const randomX = Math.floor(Math.random() * 16) - 8;
  const randomY = Math.floor(Math.random() * 16) - 8;
  
  img.style.transform = `translate(-50%, -50%) rotate(${randomRotation}deg) scale(${randomScale})`;
  img.style.marginLeft = `${randomX}px`;
  img.style.marginTop = `${randomY}px`;
}

function getNeighbors(position) {
  const neighbors = [];
  const col = position % 3;
  const row = Math.floor(position / 3);
  
  if (col > 0) neighbors.push(position - 1);
  if (col < 2) neighbors.push(position + 1);
  if (row > 0) neighbors.push(position - 3);
  if (row < 2) neighbors.push(position + 3);
  
  return neighbors;
}

function generateBoard() {
  field.innerHTML = '';
  taskList.innerHTML = '';
  selectorsDiv.classList.add('hidden');
  selectedStones = {};
  brokenStones = new Set();
  currentBoardName = null;
  updateBoardsMenu();

  // 1. –°–æ–∑–¥–∞–µ–º –ø—É–ª –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–∞–º–Ω–µ–π —Å —É—á–µ—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
  const categoryPools = {};
  categories.forEach(category => {
    categoryPools[category.name] = {
      stones: shuffleArray([...category.stones]),
      used: 0,
      max: 2 // –ú–∞–∫—Å–∏–º—É–º 2 –∫–∞–º–Ω—è –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    };
  });

  // 2. –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞–º–Ω–µ–π
  const selectedStonesArray = Array(9).fill(null);

  // 3. –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ—Å–µ–¥–µ–π –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  for (let i = 0; i < 9; i++) {
    const neighbors = getNeighbors(i);
    const forbiddenCategories = new Set();

    // –°–æ–±–∏—Ä–∞–µ–º –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—É–∂–µ 2 –∫–∞–º–Ω—è –∏–ª–∏ —Å–æ—Å–µ–¥–Ω–∏–µ)
    for (const [catName, pool] of Object.entries(categoryPools)) {
      if (pool.used >= pool.max) {
        forbiddenCategories.add(catName);
      }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ—Å–µ–¥–µ–π
    neighbors.forEach(pos => {
      if (selectedStonesArray[pos]) {
        forbiddenCategories.add(selectedStonesArray[pos].category);
      }
    });

    // –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∏ —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –∫–∞–º–Ω—è–º–∏)
    const availableCategories = categories.filter(cat => 
      !forbiddenCategories.has(cat.name) && 
      categoryPools[cat.name].stones.length > 0
    );

    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª—é–±—É—é —Å –∫–∞–º–Ω—è–º–∏
    const fallbackCategories = categories.filter(cat => 
      categoryPools[cat.name].stones.length > 0
    );

    const targetCategories = availableCategories.length > 0 
      ? availableCategories 
      : fallbackCategories;

    if (targetCategories.length === 0) break;

    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
    const category = targetCategories[
      Math.floor(Math.random() * targetCategories.length)
    ];
    const pool = categoryPools[category.name];

    // –ë–µ—Ä–µ–º –∫–∞–º–µ–Ω—å –∏–∑ –ø—É–ª–∞
    const stoneImage = pool.stones.pop();
    pool.used++;

    selectedStonesArray[i] = {
      imageName: stoneImage,
      task: category.tasks[
        category.stones.indexOf(stoneImage) % category.tasks.length
      ],
      category: category.name
    };
  }

  // 4. –†–∞–∑–º–µ—â–∞–µ–º –∫–∞–º–Ω–∏ –Ω–∞ –ø–æ–ª–µ
  selectedStonesArray.forEach((stone, index) => {
    if (!stone) return;

    const cellId = cellLabels[index];
    const imageUrl = `https://radika1.link/2025/08/01/${stone.imageName}`;
    placeStone(cellId, imageUrl);
    
    selectedStones[cellId] = {
      image: imageUrl,
      task: stone.task,
      broken: false,
      category: stone.category,
      imageName: stone.imageName
    };

    const li = document.createElement('li');
    li.dataset.cell = cellId;
    
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = `task-${cellId}`;
    checkbox.dataset.cell = cellId;
    checkbox.addEventListener('change', updateFormattedOutput);
    
    const label = document.createElement('label');
    label.htmlFor = `task-${cellId}`;
    label.textContent = `${cellId} ‚Äî ${stone.task}`;
    
    li.appendChild(checkbox);
    li.appendChild(label);
    taskList.appendChild(li);
  });
}

function placeStone(cellId, imageUrl) {
  const existing = document.querySelector(`.stone[data-cell="${cellId}"]`);
  if (existing) existing.remove();
  if (!imageUrl) return;

  const [x, y] = coords[cellId];
  const img = document.createElement('img');
  img.src = imageUrl;
  img.className = 'stone';
  img.dataset.cell = cellId;
  
  // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  const fieldWidth = field.offsetWidth;
  const scaleFactor = fieldWidth / 600; // 600 - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –ø–æ–ª—è
  
  img.style.left = `${x * scaleFactor}px`;
  img.style.top = `${y * scaleFactor}px`;
  
  if (imageUrl.includes('broken')) {
    applyBrokenEffects(img);
  }

  img.addEventListener('click', function() {
    if (brokenStones.has(cellId)) return;
    
    const category = categories.find(cat => 
      selectedStones[cellId]?.category === cat.name
    );
    if (category) {
      img.src = `https://radika1.link/2025/08/02/${category.broken}`;
      applyBrokenEffects(img);
      
      selectedStones[cellId].broken = true;
      brokenStones.add(cellId);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
      const taskItem = document.querySelector(`li[data-cell="${cellId}"]`);
      if (taskItem) {
        taskItem.classList.add('task-broken');
      }
      
      updateFormattedOutput();
    }
  });
  
  field.appendChild(img);
}

function enableManual() {
  selectorsDiv.innerHTML = '';
  selectorsDiv.classList.remove('hidden');
  taskList.innerHTML = '';

  cellLabels.forEach(cellId => {
    const container = document.createElement('div');
    const label = document.createElement('label');
    label.textContent = cellId;
    const select = document.createElement('select');
    select.dataset.cell = cellId;
    select.onchange = () => handleSelectChange(cellId, select.value);
    
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–µ–Ω—å';
    select.appendChild(defaultOption);

    if (selectedStones[cellId]?.image && !selectedStones[cellId]?.broken) {
      const category = categories.find(cat => 
        selectedStones[cellId].category === cat.name
      );
      if (category) {
        const brokenOption = document.createElement('option');
        brokenOption.value = 'broken';
        brokenOption.textContent = '‚∏∫ –†–∞–∑–±–∏—Ç—ã–π –∫–∞–º–µ–Ω—å';
        select.appendChild(brokenOption);
      }
    }

    categories.forEach(cat => {
      cat.stones.forEach((stone, index) => {
        const url = `https://radika1.link/2025/08/01/${stone}`;
        const option = document.createElement('option');
        option.value = url;
        option.textContent = `${cat.name} - ${getShortStoneName(stone)}`;
        if (selectedStones[cellId] && selectedStones[cellId].image === url) {
          option.selected = true;
        }
        select.appendChild(option);
      });
    });

    container.appendChild(label);
    container.appendChild(select);
    selectorsDiv.appendChild(container);
  });

  updateTaskList();
}

function handleSelectChange(cellId, value) {
  if (value === 'broken') {
    const category = categories.find(cat => 
      selectedStones[cellId]?.category === cat.name
    );
    if (category) {
      placeStone(cellId, `https://radika1.link/2025/08/02/${category.broken}`);
      selectedStones[cellId] = {
        ...selectedStones[cellId],
        broken: true
      };
      brokenStones.add(cellId);
      
      const taskItem = document.querySelector(`li[data-cell="${cellId}"]`);
      if (taskItem) {
        taskItem.classList.add('task-broken');
      }
    }
  } else if (value) {
    placeStone(cellId, value);
    const found = categories.flatMap(cat =>
      cat.stones.map((s, i) => ({
        url: `https://radika1.link/2025/08/01/${s}`,
        task: cat.tasks[i % cat.tasks.length],
        category: cat.name,
        imageName: s
      }))
    ).find(item => item.url === value);

    if (found) {
      selectedStones[cellId] = { 
        image: found.url, 
        task: found.task,
        broken: false,
        category: found.category,
        imageName: found.imageName
      };
      brokenStones.delete(cellId);
      
      const taskItem = document.querySelector(`li[data-cell="${cellId}"]`);
      if (taskItem) {
        taskItem.classList.remove('task-broken');
      }
    }
  } else {
    const stone = document.querySelector(`.stone[data-cell="${cellId}"]`);
    if (stone) stone.remove();
    delete selectedStones[cellId];
    brokenStones.delete(cellId);
    
    const taskItem = document.querySelector(`li[data-cell="${cellId}"]`);
    if (taskItem) {
      taskItem.remove();
    }
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
  updateTaskList();
  updateFormattedOutput();
}

function updateTaskList() {
  taskList.innerHTML = '';
  for (const [cell, data] of Object.entries(selectedStones)) {
    const li = document.createElement('li');
    li.dataset.cell = cell;
    if (data.broken) {
      li.classList.add('task-broken');
    }
    
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = `task-${cell}`;
    checkbox.dataset.cell = cell;
    checkbox.addEventListener('change', updateFormattedOutput);
    
    const label = document.createElement('label');
    label.htmlFor = `task-${cell}`;
    label.textContent = `${cell} ‚Äî ${data.task}`;
    
    li.appendChild(checkbox);
    li.appendChild(label);
    taskList.appendChild(li);
  }
}

function updateFormattedOutput() {
  const checkedItems = Array.from(document.querySelectorAll('#taskList input[type="checkbox"]:checked'));
  let outputText = '';
  
  checkedItems.forEach(checkbox => {
    const cellId = checkbox.dataset.cell;
    const stoneData = selectedStones[cellId];
    
    if (stoneData) {
      const imageUrl = `https://radika1.link/2025/08/01/${stoneData.imageName}`;
      outputText += `[center][IMG]${imageUrl}[/IMG]\n[B][I]${stoneData.task}[/I][/B][/center]\n\n`;
    }
  });
  
  formattedOutput.textContent = outputText.trim();
}

function copyToClipboard() {
  const text = formattedOutput.textContent;
  navigator.clipboard.writeText(text).then(() => {
    copyBtn.textContent = '‚úì –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!';
    setTimeout(() => {
      copyBtn.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
    }, 2000);
  }).catch(err => {
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
    copyBtn.textContent = '–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è!';
    setTimeout(() => {
      copyBtn.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
    }, 2000);
  });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.getElementById('importBoardsInput').addEventListener('change', importBoards);
updateBoardsMenu();

generateBtn.addEventListener('click', generateBoard);
manualBtn.addEventListener('click', enableManual);
copyBtn.addEventListener('click', copyToClipboard);
saveBtn.addEventListener('click', saveCurrentBoard);

window.onload = () => {
  cellLabels.forEach(cellId => {
    selectedStones[cellId] = null;
  });
};

window.addEventListener('resize', function() {
  if (Object.keys(selectedStones).length > 0) {
    for (const [cellId, stoneData] of Object.entries(selectedStones)) {
      if (stoneData && stoneData.image) {
        placeStone(cellId, stoneData.image);
      }
    }
  }
});
</script>
</body>
</html>
